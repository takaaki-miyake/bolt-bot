# Seattle Thread Backup BOT

### 概要

スレッド内でBot実行用スタンプを実行することで、スレッド内コメントのバックアップファイルを生成します。

バックアップファイルはダウンロードし、任意の場所で保管・管理してください。

### Bot名

スレッドバックアップくん

### 実行環境

- Heloku(個人アカウント運営のため、今後どうするかは検討)

### ツール＆パッケージ バージョン情報

- Python : 3.10.0
- pip : 21.3.1
  - Pythonパッケージ
    - slack_bolt : 1.9.4
    - gunicorn : 20.1.0
    - Flask : 2.0.2
    - slack-sdk : 3.11.2

### 実行方法

使用したWorkSpaceにスレッドバックアップくんを参加させることで使用可能となります。

スタンプ [ :thread_backup: ] をスレッド内で実行することで、対象スレッドのコメントのバックアップを取得します。

バックアップはtxtファイルで生成され、対象スレッド内にコメントで貼られるため、ダウンロードし任意の場所で管理してください。

スレッド外で上記スタンプを実行した場合、エラーメッセージがコメントされます。

### Token情報

token情報はスレッドバックアップくんのAPI設定画面で確認できます。

Heroku上には環境変数で登録しているため、秘匿しています。

### ローカル環境での検証方法

ローカル環境での検証はubuntuのみ確認済みです。
Windows環境の場合、wsl2でubuntu導入可能です。

1. ngrokをローカル環境に導入し、以下のコマンドを実行します。

   ```
   ./ngrok http 3000
   ```

2. main.pyが配置されているディレクトリまで遷移し、以下のコマンドで実行します。
   (flaskが導入されていないと実行されないため、注意してください)

   ```
   python main.py
   ```

3. ngrokに表示されているhttpsのURLをコピーし、末尾に/slack/eventsを付与します。

   ```
   https://XXXXXX/slack/events
   ```

4. スレッドバックアップくんのSlackAPI設定画面にアクセスし、Event Subscriptionsまで遷移します。

5. Enable EventsのRequest URLのChengeを押下し、項番3のURLを入力します。

6. **Verified** が表示され、疎通が取れたことが確認でき次第、Slackにてスレッドバックアップくんを実行することが出来ます。

※実行にはローカル環境にBot_TokenとSIGNING_SECRETの環境変数設定が必要になります。

### 問い合わせ先

詳細については三宅まで問い合わせをお願いします

takaaki.miyake@seattleconsulting.co.jp
